---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - wxt.config.ts
  - vitest.config.ts
  - eslint.config.mjs
  - tsconfig.json
  - package.json
  - entrypoints/popup/index.html
  - entrypoints/background.ts
  - entrypoints/content.ts
  - utils/charsets.ts
  - utils/types.ts
  - utils/storage.ts
  - public/icon-16.png
  - public/icon-48.png
  - public/icon-128.png
autonomous: true
requirements:
  - PLAT-01
  - PLAT-02

must_haves:
  truths:
    - "WXT project builds to a loadable MV3 extension package via `pnpm build`"
    - "Extension loads in Chrome via chrome://extensions without errors"
    - "ESLint reports errors when fetch/XMLHttpRequest/WebSocket are used anywhere in source"
    - "Three sensitivity presets (Standard, Thorough, Paranoid) are defined as data with correct character ranges"
    - "Storage items are declared with typed defaults for sensitivity, wrapperEnabled, highlightColor, scanMode"
    - "Manifest includes activeTab permission and optional all_urls"
  artifacts:
    - path: "wxt.config.ts"
      provides: "WXT + Preact + manifest configuration"
      contains: "defineConfig"
    - path: "eslint.config.mjs"
      provides: "No-network enforcement via ESLint rules"
      contains: "no-restricted-globals"
    - path: "utils/charsets.ts"
      provides: "Sensitivity preset character range definitions"
      exports: ["PRESETS", "SensitivityLevel", "SensitivityPreset", "CharRange"]
    - path: "utils/storage.ts"
      provides: "Typed storage item declarations"
      contains: "storage.defineItem"
    - path: "utils/types.ts"
      provides: "Shared TypeScript types"
  key_links:
    - from: "utils/storage.ts"
      to: "utils/charsets.ts"
      via: "imports SensitivityLevel type"
      pattern: "import.*SensitivityLevel.*charsets"
    - from: "wxt.config.ts"
      to: "manifest permissions"
      via: "manifest property"
      pattern: "activeTab.*all_urls"
---

<objective>
Scaffold the WXT project skeleton with all configuration, manifest permissions, sensitivity preset data, typed storage declarations, and no-network enforcement.

Purpose: Establish the foundation that all subsequent phases build on -- a buildable MV3 extension with the correct permission model, storage allocation, and linting rules that guarantee local-only processing.

Output: A complete WXT project that builds to a loadable Chrome extension with stub entrypoints, sensitivity preset data, and storage declarations ready for the codec and scanner to use.
</objective>

<execution_context>
@C:/Users/jozwi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/jozwi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold WXT project with Preact, Tailwind, Vitest, and ESLint</name>
  <files>
    wxt.config.ts
    vitest.config.ts
    eslint.config.mjs
    tsconfig.json
    package.json
    entrypoints/popup/index.html
    entrypoints/background.ts
    entrypoints/content.ts
    public/icon-16.png
    public/icon-48.png
    public/icon-128.png
  </files>
  <action>
    1. Initialize WXT project using vanilla template:
       `pnpm dlx wxt@latest init . --template vanilla --pm pnpm`
       (Run in the project root F:/88_CODE/InvisibleUnicode since it already has .planning/)

    2. Install dependencies:
       - Runtime: `pnpm add preact @webext-core/messaging`
       - Dev: `pnpm add -D @preact/preset-vite @tailwindcss/vite vitest @webext-core/fake-browser eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser typescript-eslint`

    3. Configure wxt.config.ts:
       - Do NOT use srcDir (flat structure per research recommendation to avoid auto-import path issues)
       - Add Preact vite plugin via `@preact/preset-vite`
       - Add Tailwind vite plugin via `@tailwindcss/vite`
       - Set manifest: name "InvisibleUnicode", description "Detect and reveal hidden Unicode text on any web page"
       - Permissions: ['storage', 'activeTab', 'scripting']
       - Optional permissions: ['<all_urls>'] for auto-scan mode (per locked decision)
       - CSP for extension_pages: "script-src 'self'; object-src 'self';" (strict MV3 minimum per research)

    4. Configure vitest.config.ts:
       - Use WxtVitest plugin from 'wxt/testing/vitest-plugin' (NOTE: check if this import path is correct for WXT 0.20.17; may be 'wxt/testing')
       - This provides auto-imports and fake-browser polyfills

    5. Configure eslint.config.mjs (flat config format for ESLint 9.x):
       - Use typescript-eslint config pattern
       - Add no-restricted-globals rule blocking: fetch, XMLHttpRequest, WebSocket, EventSource
       - Add no-restricted-properties rule blocking: navigator.sendBeacon
       - Each rule must include a message referencing PLAT-02 explaining why network calls are forbidden
       - Files pattern: '**/*.{ts,tsx}'

    6. Create stub entrypoints (minimal, just enough to build):
       - entrypoints/popup/index.html: Basic HTML with "InvisibleUnicode" title, empty body (Preact mounts here in Phase 4)
       - entrypoints/background.ts: Export default defineBackground(() => { console.log('InvisibleUnicode background ready'); })
       - entrypoints/content.ts: Export default defineContentScript with matches: ['<all_urls>'], main() empty stub

    7. Create placeholder icons in public/:
       - Generate simple 16x16, 48x48, 128x128 PNG icons (solid colored squares are fine as placeholders)
       - Use a simple script or base64-encoded minimal PNGs

    8. Add npm scripts to package.json if not already present:
       - "lint": "eslint ."
       - "test": "vitest run"
       - "test:watch": "vitest"

    9. Verify the project builds: `pnpm build`
       - Confirm output in .output/ directory
       - Confirm manifest.json in output has correct permissions

    IMPORTANT: Do NOT use srcDir config. Keep entrypoints/ and utils/ at project root (WXT default).
  </action>
  <verify>
    - `pnpm build` completes without errors
    - `.output/chrome-mv3/manifest.json` exists and contains "manifest_version": 3
    - `.output/chrome-mv3/manifest.json` contains "activeTab" in permissions
    - `.output/chrome-mv3/manifest.json` contains CSP with "script-src 'self'"
    - `pnpm lint` runs (may have warnings but no config errors)
    - `pnpm test` runs (no tests yet, but vitest config loads without errors)
  </verify>
  <done>
    WXT project builds to a valid MV3 extension. Manifest has activeTab permission, optional all_urls, strict CSP. ESLint flat config loads and enforces no-network rules. Vitest config loads with WxtVitest plugin. Stub entrypoints exist for popup, background, and content script.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create sensitivity presets, types, and storage declarations</name>
  <files>
    utils/charsets.ts
    utils/types.ts
    utils/storage.ts
  </files>
  <action>
    1. Create utils/types.ts:
       - Export any shared types needed across the extension
       - Keep minimal for Phase 1 -- types will grow as features are added

    2. Create utils/charsets.ts with sensitivity preset data (per locked decisions):
       - Export type SensitivityLevel = 'standard' | 'thorough' | 'paranoid'
       - Export interface CharRange { start: number; end: number; name: string; }
       - Export interface SensitivityPreset { level: SensitivityLevel; label: string; ranges: CharRange[]; }
       - Export const PRESETS: Record<SensitivityLevel, SensitivityPreset> with exact ranges:

       **Standard:**
       - Tags block: U+E0000-E007F
       - Zero-width & direction marks: U+200B-200F
       - FEFF (BOM/ZWNBSP): U+FEFF

       **Thorough (Standard plus):**
       - Invisible operators & word joiner: U+2060-2064
       - Variation selectors: U+FE00-FE0F

       **Paranoid (Thorough plus):**
       - Directional overrides: U+202A-202E
       - Directional isolates: U+2066-2069
       - Invisible separator: U+2063 (already in Thorough via 2060-2064 range)
       - Deprecated format chars: U+206A-206F
       - Mongolian variation selectors: U+180B-180E
       - Soft hyphen: U+00AD
       - Arabic letter mark: U+061C
       - Combining grapheme joiner: U+034F

       NOTE: U+2063 is already covered by the U+2060-2064 range in Thorough, so no separate entry needed in Paranoid.

       - Export function buildDetectionRegex(sensitivity: SensitivityLevel): RegExp
         Builds a regex from preset ranges using \u{XXXXX} syntax with /gu flags

    3. Create utils/storage.ts:
       - Import storage from 'wxt/storage'
       - Import SensitivityLevel from './charsets'
       - Declare typed storage items using storage.defineItem():
         - sensitivitySetting: sync:sensitivity, fallback 'standard'
         - wrapperEnabledSetting: sync:wrapperEnabled, fallback false (raw output default per locked decision)
         - highlightColorSetting: sync:highlightColor, fallback '#ffeb3b'
         - scanModeSetting: sync:scanMode, fallback 'onDemand'
       - Add code comments documenting storage area allocation:
         // Settings: sync storage -- syncs across devices, small data (well under 100KB)
         // Snippets (Phase 5): local storage -- per-device, 10MB limit
         // Scan results (Phase 2): session storage -- vanish on browser close
         // No usage stats or counters -- nothing to track (per user decision)

    IMPORTANT: Use sync storage for settings per research recommendation (Claude's discretion area).
    IMPORTANT: wrapperEnabled defaults to false per locked decision (raw output for common copy-paste use case).
  </action>
  <verify>
    - `pnpm build` still succeeds after adding utils files
    - TypeScript compilation has no errors: `npx tsc --noEmit` (or check via build)
    - charsets.ts exports PRESETS with exactly 3 keys: standard, thorough, paranoid
    - Each preset's ranges cover the correct Unicode ranges per the locked decisions
    - storage.ts imports from charsets.ts without circular dependencies
  </verify>
  <done>
    Three sensitivity presets defined as data with all character ranges matching the locked decisions. Storage items declared with typed defaults. All storage area allocations documented in code comments. Files compile without TypeScript errors and the build still succeeds.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` produces a valid MV3 extension in .output/chrome-mv3/
2. `pnpm lint` enforces no-network rules (test by temporarily adding `fetch` to a file -- should error)
3. manifest.json contains: manifest_version 3, activeTab, optional all_urls, strict CSP
4. utils/charsets.ts defines exactly 3 presets with correct character ranges
5. utils/storage.ts declares 4 settings with appropriate sync storage keys
6. No network-related code exists in any source file
</verification>

<success_criteria>
- WXT project builds to a loadable MV3 extension package
- Manifest has correct permissions (activeTab + optional all_urls) and strict CSP
- ESLint catches any attempt to use fetch/XMLHttpRequest/WebSocket/EventSource
- Three sensitivity presets (Standard, Thorough, Paranoid) are defined with correct character ranges per locked decisions
- Typed storage items declared with documented allocation strategy
- Project ready for codec implementation in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
