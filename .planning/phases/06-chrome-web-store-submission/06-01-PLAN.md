---
phase: 06-chrome-web-store-submission
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - utils/storage.ts
  - entrypoints/settings/App.tsx
  - package.json
  - docs/privacy-policy.html
autonomous: true
requirements:
  - PLAT-03
must_haves:
  truths:
    - "All storage writes surface a user-visible error message when quota is exceeded instead of silently failing"
    - "Version number is 1.0.0 in both package.json and the built manifest"
    - "A privacy policy HTML file exists, is self-contained, and explicitly states no data leaves the device"
    - "The extension packages into a Chrome Web Store-ready .zip via wxt zip"
  artifacts:
    - path: "utils/storage.ts"
      provides: "safeStorageWrite wrapper and updated CRUD helpers with error handling"
      contains: "QUOTA_BYTES"
    - path: "entrypoints/settings/App.tsx"
      provides: "User-facing error message on storage quota failure"
      contains: "Storage is full"
    - path: "docs/privacy-policy.html"
      provides: "Public-hostable privacy policy page"
      contains: "does not collect"
    - path: "package.json"
      provides: "Version 1.0.0"
      contains: "1.0.0"
  key_links:
    - from: "entrypoints/settings/App.tsx"
      to: "utils/storage.ts"
      via: "addSnippet/updateSnippet return StorageResult"
      pattern: "ok.*false.*quota"
---

<objective>
Prepare the extension for Chrome Web Store submission: add storage quota error handling with user-facing messages, bump version to 1.0.0, create the privacy policy HTML page, and verify the extension packages cleanly with `wxt zip`.

Purpose: Satisfies three of four Phase 6 success criteria (storage error handling, privacy policy, publishable package). The fourth (actual publication) requires manual dashboard submission in Plan 02.

Output: Production-ready .zip in `.output/`, privacy policy HTML ready to deploy, all storage writes gracefully handle quota errors.
</objective>

<execution_context>
@C:/Users/jozwi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/jozwi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-chrome-web-store-submission/06-RESEARCH.md
@utils/storage.ts
@entrypoints/settings/App.tsx
@package.json
@wxt.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add storage quota error handling and version bump</name>
  <files>utils/storage.ts, entrypoints/settings/App.tsx, package.json</files>
  <action>
1. In `utils/storage.ts`:
   - Add a `StorageResult` type: `{ ok: true } | { ok: false; reason: 'quota' | 'unknown'; message: string }`
   - Add a `safeStorageWrite` async function that wraps `item.setValue(value)` in try/catch:
     - On error containing `QUOTA_BYTES` → return `{ ok: false, reason: 'quota', message: 'Storage is full. Please delete some snippets to save new ones.' }`
     - On other errors → return `{ ok: false, reason: 'unknown', message: 'Failed to save. Please try again.' }`
     - On success → return `{ ok: true }`
   - Update `addSnippet`, `updateSnippet`, `deleteSnippet` to return `Promise<StorageResult>` using `safeStorageWrite` internally

2. In `entrypoints/settings/App.tsx`:
   - Add a `storageError` state (string | null, default null)
   - In `handleCreate`, `handleSaveEdit`, and `handleDelete`: check the `StorageResult` returned by the storage helpers. If `ok === false`, set `storageError` to the result's `message`. If `ok === true`, clear `storageError`.
   - Render a red error banner at the top (below quota warning) when `storageError` is set, with a dismiss button. Style: `bg-red-50 border border-red-300 text-red-800 text-xs px-4 py-2 rounded-md` with an X button to clear the error.

3. In `package.json`:
   - Change `"version": "0.0.1"` to `"version": "1.0.0"`

Do NOT change wxt.config.ts — WXT reads version from package.json automatically.
  </action>
  <verify>
Run `pnpm build` and check `.output/chrome-mv3/manifest.json` contains `"version": "1.0.0"`. Run `pnpm test` to confirm existing tests still pass. Verify TypeScript compiles: `pnpm compile`.
  </verify>
  <done>
All three snippet CRUD functions return StorageResult. Settings page shows a red error banner on quota failures. package.json version is 1.0.0. Build succeeds with version 1.0.0 in manifest.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create privacy policy and package extension</name>
  <files>docs/privacy-policy.html</files>
  <action>
1. Create `docs/privacy-policy.html` — a self-contained, styled HTML page suitable for GitHub Pages hosting. Content must include:
   - Title: "Privacy Policy for InvisibleUnicode"
   - Last updated date: 2026-02-20
   - **Data Collection section**: Explicitly state that InvisibleUnicode does NOT collect, transmit, or share any personal data, browsing history, or user-entered text. All processing happens entirely within the browser.
   - **Storage section**: Explain that Chrome's built-in sync storage saves preferences (scan mode, highlight color, snippet library). This data syncs across Chrome devices through Chrome's own sync infrastructure. No data is sent to any third-party server.
   - **Permissions section**: Describe each permission:
     - activeTab: Temporary access to the current tab only when the user invokes the extension
     - scripting: Injects the scanner to detect hidden Unicode characters on the active page
     - storage: Saves preferences locally
   - **Third Parties section**: No data is shared with any third party. The extension makes no network requests.
   - **Contact section**: Use a placeholder `[developer@example.com]` that the user will replace
   - Clean, readable styling using inline CSS (no external dependencies). Light background, max-width container, system font stack.

2. Run `pnpm zip` to produce the Chrome Web Store .zip package. Verify the zip file exists in `.output/`.
  </action>
  <verify>
Open `docs/privacy-policy.html` in a browser and verify it renders correctly with all required sections. Verify `.output/` contains a zip file with `1.0.0` in the filename. Run `pnpm build` first if needed.
  </verify>
  <done>
Privacy policy HTML is complete, self-contained, and ready to deploy to GitHub Pages. Extension .zip is packaged and ready for Chrome Web Store upload.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test` — all existing tests pass
2. `pnpm compile` — TypeScript compiles without errors
3. `pnpm build` — production build succeeds
4. `.output/chrome-mv3/manifest.json` contains `"version": "1.0.0"`
5. `docs/privacy-policy.html` opens in browser with all required sections
6. `.output/` contains a Chrome Web Store-ready .zip file
7. Storage CRUD functions in `utils/storage.ts` return `StorageResult` type
8. Settings page in `entrypoints/settings/App.tsx` renders error banner on storage failure
</verification>

<success_criteria>
- Storage writes are wrapped with error handling that returns structured results
- Settings UI shows user-facing error messages on quota exceeded
- Version is 1.0.0 in package.json and built manifest
- Privacy policy HTML exists with all required disclosures
- Extension is packaged as a .zip ready for Chrome Web Store upload
</success_criteria>

<output>
After completion, create `.planning/phases/06-chrome-web-store-submission/06-01-SUMMARY.md`
</output>
